<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{ profile_user.username }} ¬∑ Instatic</title>
  <style>
    body { font-family: sans-serif; background: #fafafa; margin: 0; padding-bottom: 80px; }
    header { display: flex; align-items: center; padding: 20px; background: #fff; border-bottom: 1px solid #ddd; }
    header img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-right: 20px; }
    .info h1 { margin: 0; font-size: 24px; }
    .stats { color: #666; margin-top: 5px; }
    main { padding: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
    .grid img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; }
    a { text-decoration: none; color: #007bff; }
  </style>
</head>
<body>

  <header>
    {% if profile_user.profile_pic %}
      <img src="{{ profile_user.profile_pic.url }}" alt="{{ profile_user.username }}">
    {% else %}
      <img src="https://via.placeholder.com/80" alt="Sin foto de perfil">
    {% endif %}
    <div class="info">
      <h1>{{ profile_user.username }}</h1>
      <div class="stats">
        <strong>{{ followers_count }}</strong> seguidores ¬∑
        <strong>{{ following_count }}</strong> siguiendo
      </div>
      <div class="bio">
        {{ profile_user.bio|linebreaks }}
      </div>
    </div>
    <div class="actions" style="margin-top: 10px;">
  <form method="post" style="display:inline;">
    {% csrf_token %}
    {% if is_following %}
      <button type="submit" name="unfollow" style="background:#dc3545; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer;">
        Dejar de seguir
      </button>
    {% else %}
      <button type="submit" name="follow" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer;">
        Seguir
      </button>
    {% endif %}
  </form>
</div>
  </header>

  <main>
    <h2>Fotos</h2>
{% if pics %}
  {% for pic in pics %}
    <div style="background:#fff; padding:10px; margin-bottom:20px; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
      <img src="{{ pic.image.url }}" style="width:100%; max-width:400px; border-radius:4px;">
      <p><strong>{{ pic.caption }}</strong></p>
      <div style="margin:10px 0;">
      <form method="post" style="display:inline;">
        {% csrf_token %}
        <input type="hidden" name="pic_id" value="{{ pic.id }}">
        <button type="submit" name="like" style="background:none; border:none; cursor:pointer; font-size:1.2em;">
            {% if pic.is_liked %}
                ‚ù§Ô∏è
            {% else %}
                ü§ç
            {% endif %}
        </button>
        <span>{{ pic.likes_count }} likes</span>
      </form>
      </div>

      <div>
        {% for comment in pic.comments.all %}
          <p><strong>{{ comment.user.username }}</strong>: {{ comment.content }}</p>
        {% empty %}
          <p>No hay comentarios.</p>
        {% endfor %}
      </div>

      <form method="post" style="margin-top:10px;">
        {% csrf_token %}
        {{ comment_form.content }}
        <input type="hidden" name="pic_id" value="{{ pic.id }}">
        <button type="submit" name="comment">Comentar</button>
      </form>
    </div>
  {% endfor %}
{% else %}
  <p>Este usuario no ha subido fotos.</p>
{% endif %}
{% include 'includes/footer.html' %}
  </main>

</body>
</html>
