<!DOCTYPE html>
<html lang="es">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <title>{{ profile_user.username }} ¬∑ Instatic</title>
  <link rel="stylesheet" href="{% static 'css/public_profile.css' %}">
</head>
<body>
  <div class="profile-container">
    <header class="profile-header">
      {% if profile_user.profile_pic %}
        <img src="{{ profile_user.profile_pic.url }}" alt="{{ profile_user.username }}" class="profile-avatar">
      {% else %}
        <img src="https://via.placeholder.com/150/3498db/ffffff?text={{ profile_user.username|first|upper }}" alt="Avatar" class="profile-avatar">
      {% endif %}

      <div class="profile-info">
        <h1 class="profile-username">
          {{ profile_user.username }}
          {% if profile_user == request.user %}
            <span style="font-size:14px; background:var(--primary-green); color:white; padding:2px 8px; border-radius:10px;">T√∫</span>
          {% endif %}
        </h1>

        <div class="profile-stats">
          <div class="profile-stat">
            <strong>{{ followers_count }}</strong> seguidores
          </div>
          <div class="profile-stat">
            <strong>{{ following_count }}</strong> siguiendo
          </div>
        </div>

        {% if profile_user.bio %}
          <div class="profile-bio">
            {{ profile_user.bio|linebreaks }}
          </div>
        {% endif %}
      </div>

      {% if profile_user != request.user %}
        <form method="post">
          {% csrf_token %}
          {% if is_following %}
            <button type="submit" name="unfollow" class="follow-btn unfollow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Dejar de seguir
            </button>
          {% else %}
            <button type="submit" name="follow" class="follow-btn follow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              Seguir
            </button>
          {% endif %}
        </form>
      {% endif %}
    </header>

    <div class="content-section">
      <h2 class="section-title">Fotos</h2>

      {% if pics %}
        <div class="posts-grid">
          {% for pic in pics %}
            <div class="post-card">
              <img src="{{ pic.image.url }}" alt="{{ pic.caption }}" class="post-image">

              <div class="post-content">
                {% if pic.caption %}
                  <p class="post-caption">{{ pic.caption }}</p>
                {% endif %}

                <div class="post-actions">
                  <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="pic_id" value="{{ pic.id }}">
                    <button type="submit" name="like" class="like-btn">
                      {% if pic.is_liked %}
                        ‚ù§Ô∏è
                      {% else %}
                        ü§ç
                      {% endif %}
                    </button>
                  </form>
                  <span class="likes-count">{{ pic.likes_count }} me gusta</span>
                </div>

                <form method="post" class="comment-form">
                  {% csrf_token %}
                  <input type="text" name="content" class="comment-input" placeholder="Escribe un comentario..." required>
                  <input type="hidden" name="pic_id" value="{{ pic.id }}">
                  <button type="submit" name="comment" class="comment-submit">Enviar</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-message">
          <p>{% if profile_user == request.user %}No has subido fotos a√∫n.{% else %}Este usuario no ha subido fotos.{% endif %}</p>
        </div>
      {% endif %}
    </div>
  </div>

{% include 'includes/footer.html' %}
</body>
</html>